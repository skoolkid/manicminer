<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 8FF4</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8FC5.html">8FC5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8ff4">Map</a></td>
<td class="next">
Next: <a href="9028.html">9028</a>
</td>
</tr>
</table>
<div class="description">8FF4: Draw a sprite</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="85CC.html">85CC</a> (to draw Willy on the title screen), <a href="870E.html">870E</a> (to draw the remaining lives), <a href="8944.html">8944</a> (to draw Willy, the boot and the plinth during the game over sequence), <a href="8DAA.html">8DAA</a> (to draw horizontal guardians), <a href="8DF8.html">8DF8</a> (to draw Eugene in <a href="C000.html">Eugene's Lair</a>), <a href="8E75.html">8E75</a> (to draw the Skylabs in <a href="E400.html">Skylab Landing Bay</a>), <a href="8EF1.html">8EF1</a> (to draw vertical guardians), <a href="8FC5.html">8FC5</a> (to draw the portal in the current cavern), <a href="9028.html">9028</a> (to draw Willy above ground and the swordfish graphic over the portal in <a href="FC00.html">The Final Barrier</a>) and <a href="9135.html">9135</a> (to draw the Kong Beast in <a href="CC00.html">Miner Willy meets the Kong Beast</a> and <a href="DC00.html">Return of the Alien Kong Beast</a>). If <span class="register">C</span>=1 on entry, this routine returns with the zero flag reset if any of the set bits in the sprite being drawn collides with a set bit in the background.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">Drawing mode: 0 (overwrite) or 1 (blend)</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Address of sprite graphic data</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address to draw at</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="8ff4"></span>8FF4</td>
<td class="instruction">LD B,$10</td>
<td class="comment-1" rowspan="1">There are 16 rows of pixels to draw</td>
</tr>
<tr>
<td class="address-2"><span id="8ff6"></span>8FF6</td>
<td class="instruction">BIT 0,C</td>
<td class="comment-1" rowspan="1">Set the zero flag if we're in overwrite mode</td>
</tr>
<tr>
<td class="address-1"><span id="8ff8"></span>8FF8</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up a sprite graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="8ff9"></span>8FF9</td>
<td class="instruction">JR Z,<a href="8FF4.html#8fff">$8FFF</a></td>
<td class="comment-1" rowspan="1">Jump if we're in overwrite mode</td>
</tr>
<tr>
<td class="address-1"><span id="8ffb"></span>8FFB</td>
<td class="instruction">AND (HL)</td>
<td class="comment-1" rowspan="2">Return with the zero flag reset if any of the set bits in the sprite graphic byte collide with a set bit in the background (e.g. in Willy's sprite)</td>
</tr>
<tr>
<td class="address-1"><span id="8ffc"></span>8FFC</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="8ffd"></span>8FFD</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up the sprite graphic byte again</td>
</tr>
<tr>
<td class="address-1"><span id="8ffe"></span>8FFE</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">Blend it with the background byte</td>
</tr>
<tr>
<td class="address-2"><span id="8fff"></span>8FFF</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Copy the graphic byte to its destination cell</td>
</tr>
<tr>
<td class="address-1"><span id="9000"></span>9000</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Move <span class="register">HL</span> along to the next cell on the right</td>
</tr>
<tr>
<td class="address-1"><span id="9001"></span>9001</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next sprite graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="9002"></span>9002</td>
<td class="instruction">BIT 0,C</td>
<td class="comment-1" rowspan="1">Set the zero flag if we're in overwrite mode</td>
</tr>
<tr>
<td class="address-1"><span id="9004"></span>9004</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up a sprite graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="9005"></span>9005</td>
<td class="instruction">JR Z,<a href="8FF4.html#900b">$900B</a></td>
<td class="comment-1" rowspan="1">Jump if we're in overwrite mode</td>
</tr>
<tr>
<td class="address-1"><span id="9007"></span>9007</td>
<td class="instruction">AND (HL)</td>
<td class="comment-1" rowspan="2">Return with the zero flag reset if any of the set bits in the sprite graphic byte collide with a set bit in the background (e.g. in Willy's sprite)</td>
</tr>
<tr>
<td class="address-1"><span id="9008"></span>9008</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="address-1"><span id="9009"></span>9009</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up the sprite graphic byte again</td>
</tr>
<tr>
<td class="address-1"><span id="900a"></span>900A</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">Blend it with the background byte</td>
</tr>
<tr>
<td class="address-2"><span id="900b"></span>900B</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Copy the graphic byte to its destination cell</td>
</tr>
<tr>
<td class="address-1"><span id="900c"></span>900C</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="2">Move <span class="register">HL</span> to the next pixel row down in the cell on the left</td>
</tr>
<tr>
<td class="address-1"><span id="900d"></span>900D</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="900e"></span>900E</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next sprite graphic byte</td>
</tr>
<tr>
<td class="address-1"><span id="900f"></span>900F</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="2">Have we drawn the bottom pixel row in this pair of cells yet?</td>
</tr>
<tr>
<td class="address-1"><span id="9010"></span>9010</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="9012"></span>9012</td>
<td class="instruction">JR NZ,<a href="8FF4.html#9024">$9024</a></td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="9014"></span>9014</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="6">Otherwise move <span class="register">HL</span> to the top pixel row in the cell below</td>
</tr>
<tr>
<td class="address-1"><span id="9015"></span>9015</td>
<td class="instruction">SUB $08</td>
</tr>
<tr>
<td class="address-1"><span id="9017"></span>9017</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="9018"></span>9018</td>
<td class="instruction">LD A,L</td>
</tr>
<tr>
<td class="address-1"><span id="9019"></span>9019</td>
<td class="instruction">ADD A,$20</td>
</tr>
<tr>
<td class="address-1"><span id="901b"></span>901B</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="901c"></span>901C</td>
<td class="instruction">AND $E0</td>
<td class="comment-1" rowspan="1">Was the last pair of cells at y-coordinate 7 or 15?</td>
</tr>
<tr>
<td class="address-1"><span id="901e"></span>901E</td>
<td class="instruction">JR NZ,<a href="8FF4.html#9024">$9024</a></td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="9020"></span>9020</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="3">Otherwise adjust <span class="register">HL</span> to account for the movement from the top or middle third of the screen to the next one down</td>
</tr>
<tr>
<td class="address-1"><span id="9021"></span>9021</td>
<td class="instruction">ADD A,$08</td>
</tr>
<tr>
<td class="address-1"><span id="9023"></span>9023</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-2"><span id="9024"></span>9024</td>
<td class="instruction">DJNZ <a href="8FF4.html#8ff6">$8FF6</a></td>
<td class="comment-1" rowspan="1">Jump back until all 16 rows of pixels have been drawn</td>
</tr>
<tr>
<td class="address-1"><span id="9026"></span>9026</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">Set the zero flag (to indicate no collision)</td>
</tr>
<tr>
<td class="address-1"><span id="9027"></span>9027</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8FC5.html">8FC5</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8ff4">Map</a></td>
<td class="next">
Next: <a href="9028.html">9028</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20221122</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../dec/asm/36852.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>