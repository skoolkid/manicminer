<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 8D73</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="8D0F.html">8D0F</a></span></td>
<td class="up">Up: <a href="../maps/all.html#8d73">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="8DAA.html">8DAA</a></span></td>
</tr>
</table>
<div class="description">8D73: Move and draw the light beam in Solar Power Generator</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="870E.html">870E</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d73"></span>8D73</td>
<td class="instruction">LD HL,$5C17</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (0,23) in the attribute buffer at <a href="5C00.html">5C00</a> (the source of the light beam)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d76"></span>8D76</td>
<td class="instruction">LD DE,$0020</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">DE</span> for addition (the beam travels vertically downwards to start with)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="8d79"></span>
<div class="comments">
<div class="paragraph">
The beam-drawing loop begins here.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d79"></span>8D79</td>
<td class="instruction">LD A,($8029)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the floor tile for the cavern from <a href="8020.html#8029">8029</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d7c"></span>8D7C</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does <span class="register">HL</span> point at a floor tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d7d"></span>8D7D</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so (the light beam stops here)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d7e"></span>8D7E</td>
<td class="instruction">LD A,($803B)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the cavern from <a href="8020.html#803b">803B</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d81"></span>8D81</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does <span class="register">HL</span> point at a wall tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d82"></span>8D82</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so (the light beam stops here)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d83"></span>8D83</td>
<td class="instruction">LD A,$27</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0x27 (INK 7: PAPER 4)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d85"></span>8D85</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does <span class="register">HL</span> point at a tile with this attribute value?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d86"></span>8D86</td>
<td class="instruction">JR NZ,<a href="8D73.html#8d98">$8D98</a></td>
<td class="comment-11" rowspan="1">Jump if not (the light beam is not touching Willy)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d88"></span>8D88</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1">Switch to the shadow registers briefly (to preserve <span class="register">DE</span> and <span class="register">HL</span>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d89"></span>8D89</td>
<td class="instruction">CALL <a href="8A3C.html">$8A3C</a></td>
<td class="comment-11" rowspan="4">Decrease the air supply by four units</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d8c"></span>8D8C</td>
<td class="instruction">CALL <a href="8A3C.html">$8A3C</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d8f"></span>8D8F</td>
<td class="instruction">CALL <a href="8A3C.html">$8A3C</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d92"></span>8D92</td>
<td class="instruction">CALL <a href="8A3C.html">$8A3C</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d95"></span>8D95</td>
<td class="instruction">EXX</td>
<td class="comment-11" rowspan="1">Switch back to the normal registers (restoring <span class="register">DE</span> and <span class="register">HL</span>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d96"></span>8D96</td>
<td class="instruction">JR <a href="8D73.html#8da5">$8DA5</a></td>
<td class="comment-11" rowspan="1">Jump forward to draw the light beam over Willy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d98"></span>8D98</td>
<td class="instruction">LD A,($8020)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the background tile for the cavern from <a href="8020.html">8020</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d9b"></span>8D9B</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does <span class="register">HL</span> point at a background tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d9c"></span>8D9C</td>
<td class="instruction">JR Z,<a href="8D73.html#8da5">$8DA5</a></td>
<td class="comment-11" rowspan="1">Jump if so (the light beam will not be reflected at this point)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d9e"></span>8D9E</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="6">Toggle the value in <span class="register">DE</span> between 32 and -1 (and therefore the direction of the light beam between vertically downwards and horizontally to the left): the light beam has hit a guardian</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d9f"></span>8D9F</td>
<td class="instruction">XOR $DF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8da1"></span>8DA1</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8da2"></span>8DA2</td>
<td class="instruction">LD A,D</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8da3"></span>8DA3</td>
<td class="instruction">CPL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8da4"></span>8DA4</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8da5"></span>8DA5</td>
<td class="instruction">LD (HL),$77</td>
<td class="comment-11" rowspan="1">Draw a portion of the light beam with attribute value 0x77 (INK 7: PAPER 6: BRIGHT 1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8da7"></span>8DA7</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell where the next portion of the light beam will be drawn</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8da8"></span>8DA8</td>
<td class="instruction">JR <a href="8D73.html#8d79">$8D79</a></td>
<td class="comment-11" rowspan="1">Jump back to draw the next portion of the light beam</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="8D0F.html">8D0F</a></span></td>
<td class="up">Up: <a href="../maps/all.html#8d73">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="8DAA.html">8DAA</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20171018</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2017 Richard Dymond.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 6.1.</div>
</footer>
</body>
</html>