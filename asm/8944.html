<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 8944</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="870E.html">870E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8944">Map</a></td>
<td class="next">
Next: <a href="8A3C.html">8A3C</a>
</td>
</tr>
</table>
<div class="description">8944: Display the game over sequence</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="870E.html">870E</a>. First check whether we have a new high score.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8944"></span>8944</td>
<td class="instruction">LD HL,$841F</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the high score at <a href="841F.html">841F</a></td>
</tr>
<tr>
<td class="address-1"><span id="8947"></span>8947</td>
<td class="instruction">LD DE,$8429</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the current score at <a href="8425.html#8429">8429</a></td>
</tr>
<tr>
<td class="address-1"><span id="894a"></span>894A</td>
<td class="instruction">LD B,$06</td>
<td class="comment-1" rowspan="1">There are 6 digits to compare</td>
</tr>
<tr>
<td class="address-2"><span id="894c"></span>894C</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Pick up a digit of the current score</td>
</tr>
<tr>
<td class="address-1"><span id="894d"></span>894D</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Compare it with the corresponding digit of the high score</td>
</tr>
<tr>
<td class="address-1"><span id="894e"></span>894E</td>
<td class="instruction">JP C,<a href="8944.html#8963">$8963</a></td>
<td class="comment-1" rowspan="1">Jump if it's less than the corresponding digit of the high score</td>
</tr>
<tr>
<td class="address-1"><span id="8951"></span>8951</td>
<td class="instruction">JP NZ,<a href="8944.html#8958">$8958</a></td>
<td class="comment-1" rowspan="1">Jump if it's greater than the corresponding digit of the high score</td>
</tr>
<tr>
<td class="address-1"><span id="8954"></span>8954</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the next digit of the high score</td>
</tr>
<tr>
<td class="address-1"><span id="8955"></span>8955</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the next digit of the current score</td>
</tr>
<tr>
<td class="address-1"><span id="8956"></span>8956</td>
<td class="instruction">DJNZ <a href="8944.html#894c">$894C</a></td>
<td class="comment-1" rowspan="1">Jump back to compare the next pair of digits</td>
</tr>
<tr>
<td class="address-2"><span id="8958"></span>8958</td>
<td class="instruction">LD HL,$8429</td>
<td class="comment-1" rowspan="4">Replace the high score with the current score</td>
</tr>
<tr>
<td class="address-1"><span id="895b"></span>895B</td>
<td class="instruction">LD DE,$841F</td>
</tr>
<tr>
<td class="address-1"><span id="895e"></span>895E</td>
<td class="instruction">LD BC,$0006</td>
</tr>
<tr>
<td class="address-1"><span id="8961"></span>8961</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8963"></span>
<div class="comments">
<div class="paragraph">
Now prepare the screen for the game over sequence.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8963"></span>8963</td>
<td class="instruction">LD HL,$4000</td>
<td class="comment-1" rowspan="5">Clear the top two-thirds of the display file</td>
</tr>
<tr>
<td class="address-1"><span id="8966"></span>8966</td>
<td class="instruction">LD DE,$4001</td>
</tr>
<tr>
<td class="address-1"><span id="8969"></span>8969</td>
<td class="instruction">LD BC,$0FFF</td>
</tr>
<tr>
<td class="address-1"><span id="896c"></span>896C</td>
<td class="instruction">LD (HL),$00</td>
</tr>
<tr>
<td class="address-1"><span id="896e"></span>896E</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="address-1"><span id="8970"></span>8970</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Initialise the game status buffer variable at <a href="80DC.html">80DC</a>; this variable will determine the distance of the boot from the top of the screen</td>
</tr>
<tr>
<td class="address-1"><span id="8971"></span>8971</td>
<td class="instruction">LD ($80DC),A</td>
</tr>
<tr>
<td class="address-1"><span id="8974"></span>8974</td>
<td class="instruction">LD DE,$8240</td>
<td class="comment-1" rowspan="4">Draw Willy at (12,15)</td>
</tr>
<tr>
<td class="address-1"><span id="8977"></span>8977</td>
<td class="instruction">LD HL,$488F</td>
</tr>
<tr>
<td class="address-1"><span id="897a"></span>897A</td>
<td class="instruction">LD C,$00</td>
</tr>
<tr>
<td class="address-1"><span id="897c"></span>897C</td>
<td class="instruction">CALL <a href="8FF4.html">$8FF4</a></td>
</tr>
<tr>
<td class="address-1"><span id="897f"></span>897F</td>
<td class="instruction">LD DE,$B6E0</td>
<td class="comment-1" rowspan="4">Draw the plinth (see <a href="B400.html#b6e0">B6E0</a>) underneath Willy at (14,15)</td>
</tr>
<tr>
<td class="address-1"><span id="8982"></span>8982</td>
<td class="instruction">LD HL,$48CF</td>
</tr>
<tr>
<td class="address-1"><span id="8985"></span>8985</td>
<td class="instruction">LD C,$00</td>
</tr>
<tr>
<td class="address-1"><span id="8987"></span>8987</td>
<td class="instruction">CALL <a href="8FF4.html">$8FF4</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="898a"></span>
<div class="comments">
<div class="paragraph">
The following loop draws the boot's descent onto the plinth that supports Willy.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="898a"></span>898A</td>
<td class="instruction">LD A,($80DC)</td>
<td class="comment-1" rowspan="1">Pick up the distance variable from <a href="80DC.html">80DC</a></td>
</tr>
<tr>
<td class="address-1"><span id="898d"></span>898D</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="2">Point <span class="register">BC</span> at the corresponding entry in the screen buffer address lookup table at <a href="8300.html">8300</a></td>
</tr>
<tr>
<td class="address-1"><span id="898e"></span>898E</td>
<td class="instruction">LD B,$83</td>
</tr>
<tr>
<td class="address-1"><span id="8990"></span>8990</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-1" rowspan="7">Point <span class="register">HL</span> at the corresponding location in the display file</td>
</tr>
<tr>
<td class="address-1"><span id="8991"></span>8991</td>
<td class="instruction">OR $0F</td>
</tr>
<tr>
<td class="address-1"><span id="8993"></span>8993</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="8994"></span>8994</td>
<td class="instruction">INC BC</td>
</tr>
<tr>
<td class="address-1"><span id="8995"></span>8995</td>
<td class="instruction">LD A,(BC)</td>
</tr>
<tr>
<td class="address-1"><span id="8996"></span>8996</td>
<td class="instruction">SUB $20</td>
</tr>
<tr>
<td class="address-1"><span id="8998"></span>8998</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="8999"></span>8999</td>
<td class="instruction">LD DE,$BAE0</td>
<td class="comment-1" rowspan="3">Draw the boot (see <a href="B800.html#bae0">BAE0</a>) at this location, without erasing the boot at the previous location; this leaves the portion of the boot sprite that's above the ankle in place, and makes the boot appear as if it's at the end of a long, extending trouser leg</td>
</tr>
<tr>
<td class="address-1"><span id="899c"></span>899C</td>
<td class="instruction">LD C,$00</td>
</tr>
<tr>
<td class="address-1"><span id="899e"></span>899E</td>
<td class="instruction">CALL <a href="8FF4.html">$8FF4</a></td>
</tr>
<tr>
<td class="address-1"><span id="89a1"></span>89A1</td>
<td class="instruction">LD A,($80DC)</td>
<td class="comment-1" rowspan="1">Pick up the distance variable from <a href="80DC.html">80DC</a></td>
</tr>
<tr>
<td class="address-1"><span id="89a4"></span>89A4</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0xFF-<span class="register">A</span></td>
</tr>
<tr>
<td class="address-1"><span id="89a5"></span>89A5</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Store this value (0x3F-0xFF) in <span class="register">E</span>; it determines the (rising) pitch of the sound effect that will be made</td>
</tr>
<tr>
<td class="address-1"><span id="89a6"></span>89A6</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=0 (black border)</td>
</tr>
<tr>
<td class="address-1"><span id="89a7"></span>89A7</td>
<td class="instruction">LD BC,$0040</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=0x40; this value determines the duration of the sound effect</td>
</tr>
<tr>
<td class="address-2"><span id="89aa"></span>89AA</td>
<td class="instruction">OUT ($FE),A</td>
<td class="comment-1" rowspan="6">Produce a short note whose pitch is determined by <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="89ac"></span>89AC</td>
<td class="instruction">XOR $18</td>
</tr>
<tr>
<td class="address-1"><span id="89ae"></span>89AE</td>
<td class="instruction">LD B,E</td>
</tr>
<tr>
<td class="address-2"><span id="89af"></span>89AF</td>
<td class="instruction">DJNZ <a href="8944.html#89af">$89AF</a></td>
</tr>
<tr>
<td class="address-1"><span id="89b1"></span>89B1</td>
<td class="instruction">DEC C</td>
</tr>
<tr>
<td class="address-1"><span id="89b2"></span>89B2</td>
<td class="instruction">JR NZ,<a href="8944.html#89aa">$89AA</a></td>
</tr>
<tr>
<td class="address-1"><span id="89b4"></span>89B4</td>
<td class="instruction">LD HL,$5800</td>
<td class="comment-1" rowspan="3">Prepare <span class="register">BC</span>, <span class="register">DE</span> and <span class="register">HL</span> for setting the attribute bytes in the top two-thirds of the screen</td>
</tr>
<tr>
<td class="address-1"><span id="89b7"></span>89B7</td>
<td class="instruction">LD DE,$5801</td>
</tr>
<tr>
<td class="address-1"><span id="89ba"></span>89BA</td>
<td class="instruction">LD BC,$01FF</td>
</tr>
<tr>
<td class="address-1"><span id="89bd"></span>89BD</td>
<td class="instruction">LD A,($80DC)</td>
<td class="comment-1" rowspan="1">Pick up the distance variable from <a href="80DC.html">80DC</a></td>
</tr>
<tr>
<td class="address-1"><span id="89c0"></span>89C0</td>
<td class="instruction">AND $0C</td>
<td class="comment-1" rowspan="1">Keep only bits 2 and 3</td>
</tr>
<tr>
<td class="address-1"><span id="89c2"></span>89C2</td>
<td class="instruction">RLCA</td>
<td class="comment-1" rowspan="1">Shift bits 2 and 3 into bits 3 and 4; these bits determine the PAPER colour: 0, 1, 2 or 3</td>
</tr>
<tr>
<td class="address-1"><span id="89c3"></span>89C3</td>
<td class="instruction">OR $47</td>
<td class="comment-1" rowspan="1">Set bits 0-2 (INK 7) and 6 (BRIGHT 1)</td>
</tr>
<tr>
<td class="address-1"><span id="89c5"></span>89C5</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="2">Copy this attribute value into the top two-thirds of the screen</td>
</tr>
<tr>
<td class="address-1"><span id="89c6"></span>89C6</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="address-1"><span id="89c8"></span>89C8</td>
<td class="instruction">LD A,($80DC)</td>
<td class="comment-1" rowspan="3">Add 4 to the distance variable at <a href="80DC.html">80DC</a>; this will move the boot sprite down two pixel rows</td>
</tr>
<tr>
<td class="address-1"><span id="89cb"></span>89CB</td>
<td class="instruction">ADD A,$04</td>
</tr>
<tr>
<td class="address-1"><span id="89cd"></span>89CD</td>
<td class="instruction">LD ($80DC),A</td>
</tr>
<tr>
<td class="address-1"><span id="89d0"></span>89D0</td>
<td class="instruction">CP $C4</td>
<td class="comment-1" rowspan="1">Has the boot met the plinth yet?</td>
</tr>
<tr>
<td class="address-1"><span id="89d2"></span>89D2</td>
<td class="instruction">JR NZ,<a href="8944.html#898a">$898A</a></td>
<td class="comment-1" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="89d4"></span>
<div class="comments">
<div class="paragraph">
Now print the "Game Over" message, just to drive the point home.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="89d4"></span>89D4</td>
<td class="instruction">LD IX,$844F</td>
<td class="comment-1" rowspan="4">Print "Game" (see <a href="844F.html">844F</a>) at (6,10)</td>
</tr>
<tr>
<td class="address-1"><span id="89d8"></span>89D8</td>
<td class="instruction">LD C,$04</td>
</tr>
<tr>
<td class="address-1"><span id="89da"></span>89DA</td>
<td class="instruction">LD DE,$40CA</td>
</tr>
<tr>
<td class="address-1"><span id="89dd"></span>89DD</td>
<td class="instruction">CALL <a href="92BA.html">$92BA</a></td>
</tr>
<tr>
<td class="address-1"><span id="89e0"></span>89E0</td>
<td class="instruction">LD IX,$8453</td>
<td class="comment-1" rowspan="4">Print "Over" (see <a href="8453.html">8453</a>) at (6,18)</td>
</tr>
<tr>
<td class="address-1"><span id="89e4"></span>89E4</td>
<td class="instruction">LD C,$04</td>
</tr>
<tr>
<td class="address-1"><span id="89e6"></span>89E6</td>
<td class="instruction">LD DE,$40D2</td>
</tr>
<tr>
<td class="address-1"><span id="89e9"></span>89E9</td>
<td class="instruction">CALL <a href="92BA.html">$92BA</a></td>
</tr>
<tr>
<td class="address-1"><span id="89ec"></span>89EC</td>
<td class="instruction">LD BC,$0000</td>
<td class="comment-1" rowspan="2">Prepare the delay counters for the following loop; the counter in <span class="register">C</span> will also determine the INK colours to use for the "Game Over" message</td>
</tr>
<tr>
<td class="address-1"><span id="89ef"></span>89EF</td>
<td class="instruction">LD D,$06</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="89f1"></span>
<div class="comments">
<div class="paragraph">
The following loop makes the "Game Over" message glisten for about 1.57s.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="89f1"></span>89F1</td>
<td class="instruction">DJNZ <a href="8944.html#89f1">$89F1</a></td>
<td class="comment-1" rowspan="1">Delay for about a millisecond</td>
</tr>
<tr>
<td class="address-1"><span id="89f3"></span>89F3</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="4">Change the INK colour of the "G" in "Game" at (6,10)</td>
</tr>
<tr>
<td class="address-1"><span id="89f4"></span>89F4</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="89f6"></span>89F6</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address-1"><span id="89f8"></span>89F8</td>
<td class="instruction">LD ($58CA),A</td>
</tr>
<tr>
<td class="address-1"><span id="89fb"></span>89FB</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Change the INK colour of the "a" in "Game" at (6,11)</td>
</tr>
<tr>
<td class="address-1"><span id="89fc"></span>89FC</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="89fe"></span>89FE</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address-1"><span id="8a00"></span>8A00</td>
<td class="instruction">LD ($58CB),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a03"></span>8A03</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Change the INK colour of the "m" in "Game" at (6,12)</td>
</tr>
<tr>
<td class="address-1"><span id="8a04"></span>8A04</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="8a06"></span>8A06</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address-1"><span id="8a08"></span>8A08</td>
<td class="instruction">LD ($58CC),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a0b"></span>8A0B</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Change the INK colour of the "e" in "Game" at (6,13)</td>
</tr>
<tr>
<td class="address-1"><span id="8a0c"></span>8A0C</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="8a0e"></span>8A0E</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address-1"><span id="8a10"></span>8A10</td>
<td class="instruction">LD ($58CD),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a13"></span>8A13</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Change the INK colour of the "O" in "Over" at (6,18)</td>
</tr>
<tr>
<td class="address-1"><span id="8a14"></span>8A14</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="8a16"></span>8A16</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address-1"><span id="8a18"></span>8A18</td>
<td class="instruction">LD ($58D2),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a1b"></span>8A1B</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Change the INK colour of the "v" in "Over" at (6,19)</td>
</tr>
<tr>
<td class="address-1"><span id="8a1c"></span>8A1C</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="8a1e"></span>8A1E</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address-1"><span id="8a20"></span>8A20</td>
<td class="instruction">LD ($58D3),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a23"></span>8A23</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Change the INK colour of the "e" in "Over" at (6,20)</td>
</tr>
<tr>
<td class="address-1"><span id="8a24"></span>8A24</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="8a26"></span>8A26</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address-1"><span id="8a28"></span>8A28</td>
<td class="instruction">LD ($58D4),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a2b"></span>8A2B</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Change the INK colour of the "r" in "Over" at (6,21)</td>
</tr>
<tr>
<td class="address-1"><span id="8a2c"></span>8A2C</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="address-1"><span id="8a2e"></span>8A2E</td>
<td class="instruction">OR $40</td>
</tr>
<tr>
<td class="address-1"><span id="8a30"></span>8A30</td>
<td class="instruction">LD ($58D5),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a33"></span>8A33</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Decrement the counter in <span class="register">C</span></td>
</tr>
<tr>
<td class="address-1"><span id="8a34"></span>8A34</td>
<td class="instruction">JR NZ,<a href="8944.html#89f1">$89F1</a></td>
<td class="comment-1" rowspan="1">Jump back unless it's zero</td>
</tr>
<tr>
<td class="address-1"><span id="8a36"></span>8A36</td>
<td class="instruction">DEC D</td>
<td class="comment-1" rowspan="1">Decrement the counter in <span class="register">D</span> (initially 6)</td>
</tr>
<tr>
<td class="address-1"><span id="8a37"></span>8A37</td>
<td class="instruction">JR NZ,<a href="8944.html#89f1">$89F1</a></td>
<td class="comment-1" rowspan="1">Jump back unless it's zero</td>
</tr>
<tr>
<td class="address-1"><span id="8a39"></span>8A39</td>
<td class="instruction">JP <a href="85CC.html">$85CC</a></td>
<td class="comment-1" rowspan="1">Display the title screen and play the theme tune</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="870E.html">870E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8944">Map</a></td>
<td class="next">
Next: <a href="8A3C.html">8A3C</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20200731</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/35140.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>