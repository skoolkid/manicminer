<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 8E75</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8DF8.html">8DF8</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8e75">Map</a></td>
<td class="next">
Next: <a href="8EF1.html">8EF1</a>
</td>
</tr>
</table>
<div class="description">8E75: Move and draw the Skylabs in Skylab Landing Bay</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="870E.html">870E</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8e75"></span>8E75</td>
<td class="instruction">LD IY,$80DD</td>
<td class="comment-1" rowspan="1">Point <span class="register">IY</span> at the first byte of the first vertical guardian definition at <a href="80DD.html">80DD</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8e79"></span>
<div class="comments">
<div class="paragraph">
The Skylab-moving loop begins here.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8e79"></span>8E79</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="1">Pick up the first byte of the guardian definition</td>
</tr>
<tr>
<td class="address-1"><span id="8e7c"></span>8E7C</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1">Have we dealt with all the Skylabs yet?</td>
</tr>
<tr>
<td class="address-1"><span id="8e7e"></span>8E7E</td>
<td class="instruction">JP Z,<a href="870E.html#879f">$879F</a></td>
<td class="comment-1" rowspan="1">If so, re-enter the main loop</td>
</tr>
<tr>
<td class="address-1"><span id="8e81"></span>8E81</td>
<td class="instruction">LD A,(IY+$02)</td>
<td class="comment-1" rowspan="1">Pick up the Skylab's pixel y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="8e84"></span>8E84</td>
<td class="instruction">CP (IY+$06)</td>
<td class="comment-1" rowspan="1">Has it reached its crash site yet?</td>
</tr>
<tr>
<td class="address-1"><span id="8e87"></span>8E87</td>
<td class="instruction">JR NC,<a href="8E75.html#8e91">$8E91</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="8e89"></span>8E89</td>
<td class="instruction">ADD A,(IY+$04)</td>
<td class="comment-1" rowspan="2">Increment the Skylab's y-coordinate (moving it downwards)</td>
</tr>
<tr>
<td class="address-1"><span id="8e8c"></span>8E8C</td>
<td class="instruction">LD (IY+$02),A</td>
</tr>
<tr>
<td class="address-1"><span id="8e8f"></span>8E8F</td>
<td class="instruction">JR <a href="8E75.html#8eaf">$8EAF</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8e91"></span>
<div class="comments">
<div class="paragraph">
The Skylab has reached its crash site. Start or continue its disintegration.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8e91"></span>8E91</td>
<td class="instruction">INC (IY+$01)</td>
<td class="comment-1" rowspan="1">Increment the animation frame</td>
</tr>
<tr>
<td class="address-1"><span id="8e94"></span>8E94</td>
<td class="instruction">LD A,(IY+$01)</td>
<td class="comment-1" rowspan="1">Pick up the animation frame</td>
</tr>
<tr>
<td class="address-1"><span id="8e97"></span>8E97</td>
<td class="instruction">CP $08</td>
<td class="comment-1" rowspan="1">Has the Skylab completely disintegrated yet?</td>
</tr>
<tr>
<td class="address-1"><span id="8e99"></span>8E99</td>
<td class="instruction">JR NZ,<a href="8E75.html#8eaf">$8EAF</a></td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="8e9b"></span>8E9B</td>
<td class="instruction">LD A,(IY+$05)</td>
<td class="comment-1" rowspan="2">Reset the Skylab's pixel y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="8e9e"></span>8E9E</td>
<td class="instruction">LD (IY+$02),A</td>
</tr>
<tr>
<td class="address-1"><span id="8ea1"></span>8EA1</td>
<td class="instruction">LD A,(IY+$03)</td>
<td class="comment-1" rowspan="4">Add 8 to the Skylab's x-coordinate (wrapping around at the right side of the screen)</td>
</tr>
<tr>
<td class="address-1"><span id="8ea4"></span>8EA4</td>
<td class="instruction">ADD A,$08</td>
</tr>
<tr>
<td class="address-1"><span id="8ea6"></span>8EA6</td>
<td class="instruction">AND $1F</td>
</tr>
<tr>
<td class="address-1"><span id="8ea8"></span>8EA8</td>
<td class="instruction">LD (IY+$03),A</td>
</tr>
<tr>
<td class="address-1"><span id="8eab"></span>8EAB</td>
<td class="instruction">LD (IY+$01),$00</td>
<td class="comment-1" rowspan="1">Reset the animation frame to 0</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8eaf"></span>
<div class="comments">
<div class="paragraph">
Now that the Skylab's movement has been dealt with, time to draw it.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8eaf"></span>8EAF</td>
<td class="instruction">LD E,(IY+$02)</td>
<td class="comment-1" rowspan="1">Pick up the Skylab's pixel y-coordinate in <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="8eb2"></span>8EB2</td>
<td class="instruction">RLC E</td>
<td class="comment-1" rowspan="2">Point <span class="register">DE</span> at the entry in the screen buffer address lookup table at <a href="8300.html">8300</a> that corresponds to the Skylab's pixel y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="8eb4"></span>8EB4</td>
<td class="instruction">LD D,$83</td>
</tr>
<tr>
<td class="address-1"><span id="8eb6"></span>8EB6</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="6">Point <span class="register">HL</span> at the address of the Skylab's location in the screen buffer at <a href="6000.html">6000</a></td>
</tr>
<tr>
<td class="address-1"><span id="8eb7"></span>8EB7</td>
<td class="instruction">ADD A,(IY+$03)</td>
</tr>
<tr>
<td class="address-1"><span id="8eba"></span>8EBA</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="8ebb"></span>8EBB</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="address-1"><span id="8ebc"></span>8EBC</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="address-1"><span id="8ebd"></span>8EBD</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="8ebe"></span>8EBE</td>
<td class="instruction">LD A,(IY+$01)</td>
<td class="comment-1" rowspan="1">Pick up the animation frame (0-7)</td>
</tr>
<tr>
<td class="address-1"><span id="8ec1"></span>8EC1</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="3">Multiply it by 32</td>
</tr>
<tr>
<td class="address-1"><span id="8ec2"></span>8EC2</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="8ec3"></span>8EC3</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="8ec4"></span>8EC4</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="2">Point <span class="register">DE</span> at the graphic data for the corresponding Skylab sprite (at <a href="8100.html">8100</a>+<span class="register">A</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="8ec5"></span>8EC5</td>
<td class="instruction">LD D,$81</td>
</tr>
<tr>
<td class="address-1"><span id="8ec7"></span>8EC7</td>
<td class="instruction">LD C,$01</td>
<td class="comment-1" rowspan="2">Draw the Skylab to the screen buffer at <a href="6000.html">6000</a></td>
</tr>
<tr>
<td class="address-1"><span id="8ec9"></span>8EC9</td>
<td class="instruction">CALL <a href="8FF4.html">$8FF4</a></td>
</tr>
<tr>
<td class="address-1"><span id="8ecc"></span>8ECC</td>
<td class="instruction">JP NZ,<a href="8D05.html#8d07">$8D07</a></td>
<td class="comment-1" rowspan="1">Kill Willy if the Skylab collided with him</td>
</tr>
<tr>
<td class="address-1"><span id="8ecf"></span>8ECF</td>
<td class="instruction">LD A,(IY+$02)</td>
<td class="comment-1" rowspan="12">Point <span class="register">HL</span> at the address of the Skylab's location in the attribute buffer at <a href="5C00.html">5C00</a></td>
</tr>
<tr>
<td class="address-1"><span id="8ed2"></span>8ED2</td>
<td class="instruction">AND $40</td>
</tr>
<tr>
<td class="address-1"><span id="8ed4"></span>8ED4</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="8ed5"></span>8ED5</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="8ed6"></span>8ED6</td>
<td class="instruction">ADD A,$5C</td>
</tr>
<tr>
<td class="address-1"><span id="8ed8"></span>8ED8</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="8ed9"></span>8ED9</td>
<td class="instruction">LD A,(IY+$02)</td>
</tr>
<tr>
<td class="address-1"><span id="8edc"></span>8EDC</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="8edd"></span>8EDD</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="8ede"></span>8EDE</td>
<td class="instruction">AND $E0</td>
</tr>
<tr>
<td class="address-1"><span id="8ee0"></span>8EE0</td>
<td class="instruction">OR (IY+$03)</td>
</tr>
<tr>
<td class="address-1"><span id="8ee3"></span>8EE3</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="8ee4"></span>8EE4</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="1">Pick up the Skylab's attribute byte</td>
</tr>
<tr>
<td class="address-1"><span id="8ee7"></span>8EE7</td>
<td class="instruction">CALL <a href="8DF8.html#8e5f">$8E5F</a></td>
<td class="comment-1" rowspan="1">Set the attribute bytes for the Skylab</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8eea"></span>
<div class="comments">
<div class="paragraph">
The current guardian definition has been dealt with. Time for the next one.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="8eea"></span>8EEA</td>
<td class="instruction">LD DE,$0007</td>
<td class="comment-1" rowspan="2">Point <span class="register">IY</span> at the first byte of the next vertical guardian definition</td>
</tr>
<tr>
<td class="address-1"><span id="8eed"></span>8EED</td>
<td class="instruction">ADD IY,DE</td>
</tr>
<tr>
<td class="address-1"><span id="8eef"></span>8EEF</td>
<td class="instruction">JR <a href="8E75.html#8e79">$8E79</a></td>
<td class="comment-1" rowspan="1">Jump back to deal with the next Skylab</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8DF8.html">8DF8</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8e75">Map</a></td>
<td class="next">
Next: <a href="8EF1.html">8EF1</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20200731</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../dec/asm/36469.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>