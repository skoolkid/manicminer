<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 8D0F</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="8D05.html">8D05</a></span></td>
<td class="up">Up: <a href="../maps/all.html#8d0f">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="8D73.html">8D73</a></span></td>
</tr>
</table>
<div class="description">8D0F: Move the horizontal guardians in the current cavern</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="870E.html">870E</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d0f"></span>8D0F</td>
<td class="bytes-0"></td>
<td class="instruction">LD IY,$80BE</td>
<td class="comment-11" rowspan="1">Point <span class="register">IY</span> at the first byte of the first horizontal guardian definition at <a href="80BE.html">80BE</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d13"></span>8D13</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,$0007</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">DE</span> for addition (there are 7 bytes in a guardian definition)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8d16"></span>
<div class="comments">
<div class="paragraph">
The guardian-moving loop begins here.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d16"></span>8D16</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-11" rowspan="1">Pick up the first byte of the guardian definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d19"></span>8D19</td>
<td class="bytes-0"></td>
<td class="instruction">CP $FF</td>
<td class="comment-11" rowspan="1">Have we dealt with all the guardians yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d1b"></span>8D1B</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d1c"></span>8D1C</td>
<td class="bytes-0"></td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is this guardian definition blank?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d1d"></span>8D1D</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="8D0F.html#8d6f">$8D6F</a></td>
<td class="comment-11" rowspan="1">If so, skip it and consider the next one</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d1f"></span>8D1F</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,($80BD)</td>
<td class="comment-11" rowspan="1">Pick up the value of the game clock at <a href="80BD.html">80BD</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d22"></span>8D22</td>
<td class="bytes-0"></td>
<td class="instruction">AND $04</td>
<td class="comment-11" rowspan="4">Move bit 2 (which is toggled on each pass through the main loop) to bit 7 and clear all the other bits</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d24"></span>8D24</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d25"></span>8D25</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d26"></span>8D26</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d27"></span>8D27</td>
<td class="bytes-0"></td>
<td class="instruction">AND (IY+$00)</td>
<td class="comment-11" rowspan="1">Combine this bit with bit 7 of the first byte of the guardian definition, which specifies the guardian's animation speed: 0=normal, 1=slow</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d2a"></span>8D2A</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="8D0F.html#8d6f">$8D6F</a></td>
<td class="comment-11" rowspan="1">Jump to consider the next guardian if this one is not due to be moved on this pass</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8d2c"></span>
<div class="comments">
<div class="paragraph">
The guardian will be moved on this pass.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d2c"></span>8D2C</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(IY+$04)</td>
<td class="comment-11" rowspan="1">Pick up the current animation frame (0-7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d2f"></span>8D2F</td>
<td class="bytes-0"></td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="1">Is it 3 (the terminal frame for a guardian moving right)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d31"></span>8D31</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="8D0F.html#8d43">$8D43</a></td>
<td class="comment-11" rowspan="1">Jump if so to move the guardian right across a cell boundary or turn it round</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d33"></span>8D33</td>
<td class="bytes-0"></td>
<td class="instruction">CP $04</td>
<td class="comment-11" rowspan="1">Is the current animation frame 4 (the terminal frame for a guardian moving left)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d35"></span>8D35</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="8D0F.html#8d5a">$8D5A</a></td>
<td class="comment-11" rowspan="1">Jump if so to move the guardian left across a cell boundary or turn it round</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d37"></span>8D37</td>
<td class="bytes-0"></td>
<td class="instruction">JR NC,<a href="8D0F.html#8d3e">$8D3E</a></td>
<td class="comment-11" rowspan="1">Jump if the animation frame is 5, 6 or 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d39"></span>8D39</td>
<td class="bytes-0"></td>
<td class="instruction">INC (IY+$04)</td>
<td class="comment-11" rowspan="1">Increment the animation frame (this guardian is moving right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d3c"></span>8D3C</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="8D0F.html#8d6f">$8D6F</a></td>
<td class="comment-11" rowspan="1">Jump forward to consider the next guardian</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d3e"></span>8D3E</td>
<td class="bytes-0"></td>
<td class="instruction">DEC (IY+$04)</td>
<td class="comment-11" rowspan="1">Decrement the animation frame (this guardian is moving left)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d41"></span>8D41</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="8D0F.html#8d6f">$8D6F</a></td>
<td class="comment-11" rowspan="1">Jump forward to consider the next guardian</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d43"></span>8D43</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(IY+$01)</td>
<td class="comment-11" rowspan="1">Pick up the LSB of the address of the guardian's location in the attribute buffer at <a href="5C00.html">5C00</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d46"></span>8D46</td>
<td class="bytes-0"></td>
<td class="instruction">CP (IY+$06)</td>
<td class="comment-11" rowspan="1">Has the guardian reached the rightmost point in its path?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d49"></span>8D49</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="8D0F.html#8d51">$8D51</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d4b"></span>8D4B</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+$04),$07</td>
<td class="comment-11" rowspan="1">Set the animation frame to 7 (turning the guardian round to face left)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d4f"></span>8D4F</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="8D0F.html#8d6f">$8D6F</a></td>
<td class="comment-11" rowspan="1">Jump forward to consider the next guardian</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d51"></span>8D51</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+$04),$00</td>
<td class="comment-11" rowspan="1">Set the animation frame to 0 (the initial frame for a guardian moving right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d55"></span>8D55</td>
<td class="bytes-0"></td>
<td class="instruction">INC (IY+$01)</td>
<td class="comment-11" rowspan="1">Increment the guardian's x-coordinate (moving it right across a cell boundary)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d58"></span>8D58</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="8D0F.html#8d6f">$8D6F</a></td>
<td class="comment-11" rowspan="1">Jump forward to consider the next guardian</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d5a"></span>8D5A</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(IY+$01)</td>
<td class="comment-11" rowspan="1">Pick up the LSB of the address of the guardian's location in the attribute buffer at <a href="5C00.html">5C00</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d5d"></span>8D5D</td>
<td class="bytes-0"></td>
<td class="instruction">CP (IY+$05)</td>
<td class="comment-11" rowspan="1">Has the guardian reached the leftmost point in its path?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d60"></span>8D60</td>
<td class="bytes-0"></td>
<td class="instruction">JR NZ,<a href="8D0F.html#8d68">$8D68</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d62"></span>8D62</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+$04),$00</td>
<td class="comment-11" rowspan="1">Set the animation frame to 0 (turning the guardian round to face right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d66"></span>8D66</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="8D0F.html#8d6f">$8D6F</a></td>
<td class="comment-11" rowspan="1">Jump forward to consider the next guardian</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d68"></span>8D68</td>
<td class="bytes-0"></td>
<td class="instruction">LD (IY+$04),$07</td>
<td class="comment-11" rowspan="1">Set the animation frame to 7 (the initial frame for a guardian moving left)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d6c"></span>8D6C</td>
<td class="bytes-0"></td>
<td class="instruction">DEC (IY+$01)</td>
<td class="comment-11" rowspan="1">Decrement the guardian's x-coordinate (moving it left across a cell boundary)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8d6f"></span>
<div class="comments">
<div class="paragraph">
The current guardian definition has been dealt with. Time for the next one.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="8d6f"></span>8D6F</td>
<td class="bytes-0"></td>
<td class="instruction">ADD IY,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">IY</span> at the first byte of the next horizontal guardian definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="8d71"></span>8D71</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="8D0F.html#8d16">$8D16</a></td>
<td class="comment-11" rowspan="1">Jump back to deal with the next horizontal guardian</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="8D05.html">8D05</a></span></td>
<td class="up">Up: <a href="../maps/all.html#8d0f">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="8D73.html">8D73</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20190605</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../dec/asm/36111.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>