<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 8A3C</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8944.html">8944</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8a3c">Map</a></td>
<td class="next">
Next: <a href="8A75.html">8A75</a>
</td>
</tr>
</table>
<div class="description">8A3C: Decrease the air remaining in the current cavern</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="870E.html">870E</a>, <a href="8D73.html">8D73</a> and <a href="9028.html">9028</a>. Returns with the zero flag set if there is no air remaining.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8a3c"></span>8A3C</td>
<td class="instruction">LD A,($80BD)</td>
<td class="comment-1" rowspan="3">Update the game clock at <a href="80BD.html">80BD</a></td>
</tr>
<tr>
<td class="address-1"><span id="8a3f"></span>8A3F</td>
<td class="instruction">SUB $04</td>
</tr>
<tr>
<td class="address-1"><span id="8a41"></span>8A41</td>
<td class="instruction">LD ($80BD),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a44"></span>8A44</td>
<td class="instruction">CP $FC</td>
<td class="comment-1" rowspan="1">Was it just decreased from zero?</td>
</tr>
<tr>
<td class="address-1"><span id="8a46"></span>8A46</td>
<td class="instruction">JR NZ,<a href="8A3C.html#8a55">$8A55</a></td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="8a48"></span>8A48</td>
<td class="instruction">LD A,($80BC)</td>
<td class="comment-1" rowspan="1">Pick up the value of the remaining air supply from <a href="80BC.html">80BC</a></td>
</tr>
<tr>
<td class="address-1"><span id="8a4b"></span>8A4B</td>
<td class="instruction">CP $24</td>
<td class="comment-1" rowspan="1">Has the air supply run out?</td>
</tr>
<tr>
<td class="address-1"><span id="8a4d"></span>8A4D</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return (with the zero flag set) if so</td>
</tr>
<tr>
<td class="address-1"><span id="8a4e"></span>8A4E</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="2">Decrement the air supply at <a href="80BC.html">80BC</a></td>
</tr>
<tr>
<td class="address-1"><span id="8a4f"></span>8A4F</td>
<td class="instruction">LD ($80BC),A</td>
</tr>
<tr>
<td class="address-1"><span id="8a52"></span>8A52</td>
<td class="instruction">LD A,($80BD)</td>
<td class="comment-1" rowspan="1">Pick up the value of the game clock at <a href="80BD.html">80BD</a></td>
</tr>
<tr>
<td class="address-2"><span id="8a55"></span>8A55</td>
<td class="instruction">AND $E0</td>
<td class="comment-1" rowspan="4"><span class="register">A</span>=INT(<span class="register">A</span>/32); this value specifies how many pixels to draw from left to right in the cell at the right end of the air bar</td>
</tr>
<tr>
<td class="address-1"><span id="8a57"></span>8A57</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="8a58"></span>8A58</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="8a59"></span>8A59</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="8a5a"></span>8A5A</td>
<td class="instruction">LD E,$00</td>
<td class="comment-1" rowspan="1">Initialise <span class="register">E</span> to 0 (all bits reset)</td>
</tr>
<tr>
<td class="address-1"><span id="8a5c"></span>8A5C</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Do we need to draw any pixels in the cell at the right end of the air bar?</td>
</tr>
<tr>
<td class="address-1"><span id="8a5d"></span>8A5D</td>
<td class="instruction">JR Z,<a href="8A3C.html#8a66">$8A66</a></td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="8a5f"></span>8A5F</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Copy the number of pixels to draw (1-7) to <span class="register">B</span></td>
</tr>
<tr>
<td class="address-2"><span id="8a60"></span>8A60</td>
<td class="instruction">RRC E</td>
<td class="comment-1" rowspan="3">Set this many bits in <span class="register">E</span> (from bit 7 towards bit 0)</td>
</tr>
<tr>
<td class="address-1"><span id="8a62"></span>8A62</td>
<td class="instruction">SET 7,E</td>
</tr>
<tr>
<td class="address-1"><span id="8a64"></span>8A64</td>
<td class="instruction">DJNZ <a href="8A3C.html#8a60">$8A60</a></td>
</tr>
<tr>
<td class="address-2"><span id="8a66"></span>8A66</td>
<td class="instruction">LD A,($80BC)</td>
<td class="comment-1" rowspan="1">Pick up the value of the remaining air supply from <a href="80BC.html">80BC</a></td>
</tr>
<tr>
<td class="address-1"><span id="8a69"></span>8A69</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="2">Set <span class="register">HL</span> to the display file address at which to draw the top row of pixels in the cell at the right end of the air bar</td>
</tr>
<tr>
<td class="address-1"><span id="8a6a"></span>8A6A</td>
<td class="instruction">LD H,$52</td>
</tr>
<tr>
<td class="address-1"><span id="8a6c"></span>8A6C</td>
<td class="instruction">LD B,$04</td>
<td class="comment-1" rowspan="1">There are four rows of pixels to draw</td>
</tr>
<tr>
<td class="address-2"><span id="8a6e"></span>8A6E</td>
<td class="instruction">LD (HL),E</td>
<td class="comment-1" rowspan="3">Draw the four rows of pixels at the right end of the air bar</td>
</tr>
<tr>
<td class="address-1"><span id="8a6f"></span>8A6F</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="8a70"></span>8A70</td>
<td class="instruction">DJNZ <a href="8A3C.html#8a6e">$8A6E</a></td>
</tr>
<tr>
<td class="address-1"><span id="8a72"></span>8A72</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Reset the zero flag to indicate that there is still some air remaining; these instructions are redundant, since the zero flag is already reset at this point</td>
</tr>
<tr>
<td class="address-1"><span id="8a73"></span>8A73</td>
<td class="instruction">INC A</td>
</tr>
<tr>
<td class="address-1"><span id="8a74"></span>8A74</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8944.html">8944</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8a3c">Map</a></td>
<td class="next">
Next: <a href="8A75.html">8A75</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20221122</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../dec/asm/35388.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>