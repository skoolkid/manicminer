<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 8DAA</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../images/logo-hex.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8D73.html">8D73</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8daa">Map</a></td>
<td class="next">
Next: <a href="8DF8.html">8DF8</a>
</td>
</tr>
</table>
<div class="description">8DAA: Draw the horizontal guardians in the current cavern</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="870E.html">870E</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8daa"></span>8DAA</td>
<td class="instruction">LD IY,$80BE</td>
<td class="comment-1" rowspan="1">Point <span class="register">IY</span> at the first byte of the first horizontal guardian definition at <a href="80BE.html">80BE</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8dae"></span>
<div class="comments">
<div class="paragraph">
The guardian-drawing loop begins here.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8dae"></span>8DAE</td>
<td class="instruction">LD A,(IY+$00)</td>
<td class="comment-1" rowspan="1">Pick up the first byte of the guardian definition</td>
</tr>
<tr>
<td class="address-1"><span id="8db1"></span>8DB1</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1">Have we dealt with all the guardians yet?</td>
</tr>
<tr>
<td class="address-1"><span id="8db3"></span>8DB3</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="address-1"><span id="8db4"></span>8DB4</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Is this guardian definition blank?</td>
</tr>
<tr>
<td class="address-1"><span id="8db5"></span>8DB5</td>
<td class="instruction">JR Z,<a href="8DAA.html#8df1">$8DF1</a></td>
<td class="comment-1" rowspan="1">If so, skip it and consider the next one</td>
</tr>
<tr>
<td class="address-1"><span id="8db7"></span>8DB7</td>
<td class="instruction">LD DE,$001F</td>
<td class="comment-1" rowspan="1">Prepare <span class="register">DE</span> for addition</td>
</tr>
<tr>
<td class="address-1"><span id="8dba"></span>8DBA</td>
<td class="instruction">LD L,(IY+$01)</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the address of the guardian's location in the attribute buffer at <a href="5C00.html">5C00</a></td>
</tr>
<tr>
<td class="address-1"><span id="8dbd"></span>8DBD</td>
<td class="instruction">LD H,(IY+$02)</td>
</tr>
<tr>
<td class="address-1"><span id="8dc0"></span>8DC0</td>
<td class="instruction">AND $7F</td>
<td class="comment-1" rowspan="1">Reset bit 7 (which specifies the animation speed) of the attribute byte, ensuring no FLASH</td>
</tr>
<tr>
<td class="address-1"><span id="8dc2"></span>8DC2</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="7">Set the attribute bytes for the guardian in the buffer at <a href="5C00.html">5C00</a></td>
</tr>
<tr>
<td class="address-1"><span id="8dc3"></span>8DC3</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="8dc4"></span>8DC4</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="8dc5"></span>8DC5</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="address-1"><span id="8dc6"></span>8DC6</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="8dc7"></span>8DC7</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="address-1"><span id="8dc8"></span>8DC8</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="8dc9"></span>8DC9</td>
<td class="instruction">LD C,$01</td>
<td class="comment-1" rowspan="1">Prepare <span class="register">C</span> for the call to the drawing routine at <a href="8FF4.html">8FF4</a> later on</td>
</tr>
<tr>
<td class="address-1"><span id="8dcb"></span>8DCB</td>
<td class="instruction">LD A,(IY+$04)</td>
<td class="comment-1" rowspan="1">Pick up the animation frame (0-7)</td>
</tr>
<tr>
<td class="address-1"><span id="8dce"></span>8DCE</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="3">Multiply it by 32</td>
</tr>
<tr>
<td class="address-1"><span id="8dcf"></span>8DCF</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="8dd0"></span>8DD0</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="8dd1"></span>8DD1</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Copy the result to <span class="register">E</span></td>
</tr>
<tr>
<td class="address-1"><span id="8dd2"></span>8DD2</td>
<td class="instruction">LD A,($8407)</td>
<td class="comment-1" rowspan="1">Pick up the number of the current cavern from <a href="8407.html">8407</a></td>
</tr>
<tr>
<td class="address-1"><span id="8dd5"></span>8DD5</td>
<td class="instruction">CP $07</td>
<td class="comment-1" rowspan="1">Are we in one of the first seven caverns?</td>
</tr>
<tr>
<td class="address-1"><span id="8dd7"></span>8DD7</td>
<td class="instruction">JR C,<a href="8DAA.html#8de3">$8DE3</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="8dd9"></span>8DD9</td>
<td class="instruction">CP $09</td>
<td class="comment-1" rowspan="1">Are we in <a href="D400.html">The Endorian Forest</a>?</td>
</tr>
<tr>
<td class="address-1"><span id="8ddb"></span>8DDB</td>
<td class="instruction">JR Z,<a href="8DAA.html#8de3">$8DE3</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="8ddd"></span>8DDD</td>
<td class="instruction">CP $0F</td>
<td class="comment-1" rowspan="1">Are we in <a href="EC00.html">The Sixteenth Cavern</a>?</td>
</tr>
<tr>
<td class="address-1"><span id="8ddf"></span>8DDF</td>
<td class="instruction">JR Z,<a href="8DAA.html#8de3">$8DE3</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="8de1"></span>8DE1</td>
<td class="instruction">SET 7,E</td>
<td class="comment-1" rowspan="1">Add 0x80 to <span class="register">E</span> (the horizontal guardians in this cavern use frames 4-7 only)</td>
</tr>
<tr>
<td class="address-2"><span id="8de3"></span>8DE3</td>
<td class="instruction">LD D,$81</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at the graphic data for the appropriate guardian sprite (at <a href="8100.html">8100</a>+<span class="register">E</span>)</td>
</tr>
<tr>
<td class="address-1"><span id="8de5"></span>8DE5</td>
<td class="instruction">LD L,(IY+$01)</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at the address of the guardian's location in the screen buffer at <a href="6000.html">6000</a></td>
</tr>
<tr>
<td class="address-1"><span id="8de8"></span>8DE8</td>
<td class="instruction">LD H,(IY+$03)</td>
</tr>
<tr>
<td class="address-1"><span id="8deb"></span>8DEB</td>
<td class="instruction">CALL <a href="8FF4.html">$8FF4</a></td>
<td class="comment-1" rowspan="1">Draw the guardian to the screen buffer at <a href="6000.html">6000</a></td>
</tr>
<tr>
<td class="address-1"><span id="8dee"></span>8DEE</td>
<td class="instruction">JP NZ,<a href="8D05.html#8d06">$8D06</a></td>
<td class="comment-1" rowspan="1">Kill Willy if the guardian collided with him</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="8df1"></span>
<div class="comments">
<div class="paragraph">
The current guardian definition has been dealt with. Time for the next one.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="8df1"></span>8DF1</td>
<td class="instruction">LD DE,$0007</td>
<td class="comment-1" rowspan="2">Point <span class="register">IY</span> at the first byte of the next horizontal guardian definition</td>
</tr>
<tr>
<td class="address-1"><span id="8df4"></span>8DF4</td>
<td class="instruction">ADD IY,DE</td>
</tr>
<tr>
<td class="address-1"><span id="8df6"></span>8DF6</td>
<td class="instruction">JR <a href="8DAA.html#8dae">$8DAE</a></td>
<td class="comment-1" rowspan="1">Jump back to deal with the next horizontal guardian</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8D73.html">8D73</a>
</td>
<td class="up">Up: <a href="../maps/all.html#8daa">Map</a></td>
<td class="next">
Next: <a href="8DF8.html">8DF8</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20221122</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../dec/asm/36266.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>