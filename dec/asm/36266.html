<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 36266</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="36211.html">36211</a></span></td>
<td class="up">Up: <a href="../maps/all.html#36266">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="36344.html">36344</a></span></td>
</tr>
</table>
<div class="description">36266: Draw the horizontal guardians in the current cavern</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="34574.html">34574</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="36266"></span>36266</td>
<td class="bytes-0"></td>
<td class="instruction">LD IY,32958</td>
<td class="comment-11" rowspan="1">Point <span class="register">IY</span> at the first byte of the first horizontal guardian definition at <a href="32958.html">32958</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="36270"></span>
<div class="comments">
<div class="paragraph">
The guardian-drawing loop begins here.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="36270"></span>36270</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(IY+0)</td>
<td class="comment-11" rowspan="1">Pick up the first byte of the guardian definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36273"></span>36273</td>
<td class="bytes-0"></td>
<td class="instruction">CP 255</td>
<td class="comment-11" rowspan="1">Have we dealt with all the guardians yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36275"></span>36275</td>
<td class="bytes-0"></td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36276"></span>36276</td>
<td class="bytes-0"></td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is this guardian definition blank?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36277"></span>36277</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="36266.html#36337">36337</a></td>
<td class="comment-11" rowspan="1">If so, skip it and consider the next one</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36279"></span>36279</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,31</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">DE</span> for addition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36282"></span>36282</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,(IY+1)</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the address of the guardian's location in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36285"></span>36285</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,(IY+2)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36288"></span>36288</td>
<td class="bytes-0"></td>
<td class="instruction">AND 127</td>
<td class="comment-11" rowspan="1">Reset bit 7 (which specifies the animation speed) of the attribute byte, ensuring no FLASH</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36290"></span>36290</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="7">Set the attribute bytes for the guardian in the buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36291"></span>36291</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36292"></span>36292</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36293"></span>36293</td>
<td class="bytes-0"></td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36294"></span>36294</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36295"></span>36295</td>
<td class="bytes-0"></td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36296"></span>36296</td>
<td class="bytes-0"></td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36297"></span>36297</td>
<td class="bytes-0"></td>
<td class="instruction">LD C,1</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">C</span> for the call to the drawing routine at <a href="36852.html">36852</a> later on</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36299"></span>36299</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(IY+4)</td>
<td class="comment-11" rowspan="1">Pick up the animation frame (0-7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36302"></span>36302</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="3">Multiply it by 32</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36303"></span>36303</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36304"></span>36304</td>
<td class="bytes-0"></td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36305"></span>36305</td>
<td class="bytes-0"></td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Copy the result to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36306"></span>36306</td>
<td class="bytes-0"></td>
<td class="instruction">LD A,(33799)</td>
<td class="comment-11" rowspan="1">Pick up the number of the current cavern from <a href="33799.html">33799</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36309"></span>36309</td>
<td class="bytes-0"></td>
<td class="instruction">CP 7</td>
<td class="comment-11" rowspan="1">Are we in one of the first seven caverns?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36311"></span>36311</td>
<td class="bytes-0"></td>
<td class="instruction">JR C,<a href="36266.html#36323">36323</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36313"></span>36313</td>
<td class="bytes-0"></td>
<td class="instruction">CP 9</td>
<td class="comment-11" rowspan="1">Are we in <a href="54272.html">The Endorian Forest</a>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36315"></span>36315</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="36266.html#36323">36323</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36317"></span>36317</td>
<td class="bytes-0"></td>
<td class="instruction">CP 15</td>
<td class="comment-11" rowspan="1">Are we in <a href="60416.html">The Sixteenth Cavern</a>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36319"></span>36319</td>
<td class="bytes-0"></td>
<td class="instruction">JR Z,<a href="36266.html#36323">36323</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36321"></span>36321</td>
<td class="bytes-0"></td>
<td class="instruction">SET 7,E</td>
<td class="comment-11" rowspan="1">Add 128 to <span class="register">E</span> (the horizontal guardians in this cavern use frames 4-7 only)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="36323"></span>36323</td>
<td class="bytes-0"></td>
<td class="instruction">LD D,129</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the graphic data for the appropriate guardian sprite (at <a href="33024.html">33024</a>+<span class="register">E</span>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36325"></span>36325</td>
<td class="bytes-0"></td>
<td class="instruction">LD L,(IY+1)</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the address of the guardian's location in the screen buffer at <a href="24576.html">24576</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36328"></span>36328</td>
<td class="bytes-0"></td>
<td class="instruction">LD H,(IY+3)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36331"></span>36331</td>
<td class="bytes-0"></td>
<td class="instruction">CALL <a href="36852.html">36852</a></td>
<td class="comment-11" rowspan="1">Draw the guardian to the screen buffer at <a href="24576.html">24576</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36334"></span>36334</td>
<td class="bytes-0"></td>
<td class="instruction">JP NZ,<a href="36101.html#36102">36102</a></td>
<td class="comment-11" rowspan="1">Kill Willy if the guardian collided with him</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="36337"></span>
<div class="comments">
<div class="paragraph">
The current guardian definition has been dealt with. Time for the next one.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="36337"></span>36337</td>
<td class="bytes-0"></td>
<td class="instruction">LD DE,7</td>
<td class="comment-11" rowspan="2">Point <span class="register">IY</span> at the first byte of the next horizontal guardian definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36340"></span>36340</td>
<td class="bytes-0"></td>
<td class="instruction">ADD IY,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="36342"></span>36342</td>
<td class="bytes-0"></td>
<td class="instruction">JR <a href="36266.html#36270">36270</a></td>
<td class="comment-11" rowspan="1">Jump back to deal with the next horizontal guardian</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="36211.html">36211</a></span></td>
<td class="up">Up: <a href="../maps/all.html#36266">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="36344.html">36344</a></span></td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20190605</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 7.2.</div>
<div><a href="../../asm/8DAA.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>