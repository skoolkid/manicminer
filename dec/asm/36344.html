<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 36344</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="36266.html">36266</a>
</td>
<td class="up">Up: <a href="../maps/all.html#36344">Map</a></td>
<td class="next">
Next: <a href="36469.html">36469</a>
</td>
</tr>
</table>
<div class="description">36344: Move and draw Eugene in Eugene's Lair</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="34574.html">34574</a>. First we move Eugene up or down, or change his direction.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="36344"></span>36344</td>
<td class="instruction">LD A,(32884)</td>
<td class="comment-1" rowspan="1">Pick up the attribute of the last item drawn from <a href="32884.html">32884</a></td>
</tr>
<tr>
<td class="address-1"><span id="36347"></span>36347</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Have all the items been collected?</td>
</tr>
<tr>
<td class="address-1"><span id="36348"></span>36348</td>
<td class="instruction">JR Z,<a href="36344.html#36367">36367</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="36350"></span>36350</td>
<td class="instruction">LD A,(32987)</td>
<td class="comment-1" rowspan="1">Pick up Eugene's direction from <a href="32987.html">32987</a></td>
</tr>
<tr>
<td class="address-1"><span id="36353"></span>36353</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Is Eugene moving downwards?</td>
</tr>
<tr>
<td class="address-1"><span id="36354"></span>36354</td>
<td class="instruction">JR Z,<a href="36344.html#36367">36367</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="36356"></span>36356</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-1" rowspan="1">Pick up Eugene's pixel y-coordinate from <a href="32988.html">32988</a></td>
</tr>
<tr>
<td class="address-1"><span id="36359"></span>36359</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrement it (moving Eugene up)</td>
</tr>
<tr>
<td class="address-1"><span id="36360"></span>36360</td>
<td class="instruction">JR Z,<a href="36344.html#36380">36380</a></td>
<td class="comment-1" rowspan="1">Jump if Eugene has reached the top of the cavern</td>
</tr>
<tr>
<td class="address-1"><span id="36362"></span>36362</td>
<td class="instruction">LD (32988),A</td>
<td class="comment-1" rowspan="1">Update Eugene's pixel y-coordinate at <a href="32988.html">32988</a></td>
</tr>
<tr>
<td class="address-1"><span id="36365"></span>36365</td>
<td class="instruction">JR <a href="36344.html#36388">36388</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="36367"></span>36367</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-1" rowspan="1">Pick up Eugene's pixel y-coordinate from <a href="32988.html">32988</a></td>
</tr>
<tr>
<td class="address-1"><span id="36370"></span>36370</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment it (moving Eugene down)</td>
</tr>
<tr>
<td class="address-1"><span id="36371"></span>36371</td>
<td class="instruction">CP 88</td>
<td class="comment-1" rowspan="1">Has Eugene reached the portal yet?</td>
</tr>
<tr>
<td class="address-1"><span id="36373"></span>36373</td>
<td class="instruction">JR Z,<a href="36344.html#36380">36380</a></td>
<td class="comment-1" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="address-1"><span id="36375"></span>36375</td>
<td class="instruction">LD (32988),A</td>
<td class="comment-1" rowspan="1">Update Eugene's pixel y-coordinate at <a href="32988.html">32988</a></td>
</tr>
<tr>
<td class="address-1"><span id="36378"></span>36378</td>
<td class="instruction">JR <a href="36344.html#36388">36388</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="address-2"><span id="36380"></span>36380</td>
<td class="instruction">LD A,(32987)</td>
<td class="comment-1" rowspan="3">Toggle Eugene's direction at <a href="32987.html">32987</a></td>
</tr>
<tr>
<td class="address-1"><span id="36383"></span>36383</td>
<td class="instruction">XOR 1</td>
</tr>
<tr>
<td class="address-1"><span id="36385"></span>36385</td>
<td class="instruction">LD (32987),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="36388"></span>
<div class="comments">
<div class="paragraph">
Now that Eugene's movement has been dealt with, it's time to draw him.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="36388"></span>36388</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-1" rowspan="1">Pick up Eugene's pixel y-coordinate from <a href="32988.html">32988</a></td>
</tr>
<tr>
<td class="address-1"><span id="36391"></span>36391</td>
<td class="instruction">AND 127</td>
<td class="comment-1" rowspan="4">Point <span class="register">DE</span> at the entry in the screen buffer address lookup table at <a href="33536.html">33536</a> that corresponds to Eugene's y-coordinate</td>
</tr>
<tr>
<td class="address-1"><span id="36393"></span>36393</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="36394"></span>36394</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="address-1"><span id="36395"></span>36395</td>
<td class="instruction">LD D,131</td>
</tr>
<tr>
<td class="address-1"><span id="36397"></span>36397</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="6">Point <span class="register">HL</span> at the address of Eugene's location in the screen buffer at <a href="24576.html">24576</a></td>
</tr>
<tr>
<td class="address-1"><span id="36398"></span>36398</td>
<td class="instruction">OR 15</td>
</tr>
<tr>
<td class="address-1"><span id="36400"></span>36400</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="36401"></span>36401</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="address-1"><span id="36402"></span>36402</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="address-1"><span id="36403"></span>36403</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="36404"></span>36404</td>
<td class="instruction">LD DE,32992</td>
<td class="comment-1" rowspan="3">Draw Eugene to the screen buffer at <a href="24576.html">24576</a></td>
</tr>
<tr>
<td class="address-1"><span id="36407"></span>36407</td>
<td class="instruction">LD C,1</td>
</tr>
<tr>
<td class="address-1"><span id="36409"></span>36409</td>
<td class="instruction">CALL <a href="36852.html">36852</a></td>
</tr>
<tr>
<td class="address-1"><span id="36412"></span>36412</td>
<td class="instruction">JP NZ,<a href="36101.html#36102">36102</a></td>
<td class="comment-1" rowspan="1">Kill Willy if Eugene collided with him</td>
</tr>
<tr>
<td class="address-1"><span id="36415"></span>36415</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-1" rowspan="1">Pick up Eugene's pixel y-coordinate from <a href="32988.html">32988</a></td>
</tr>
<tr>
<td class="address-1"><span id="36418"></span>36418</td>
<td class="instruction">AND 120</td>
<td class="comment-1" rowspan="9">Point <span class="register">HL</span> at the address of Eugene's location in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="address-1"><span id="36420"></span>36420</td>
<td class="instruction">RLCA</td>
</tr>
<tr>
<td class="address-1"><span id="36421"></span>36421</td>
<td class="instruction">OR 7</td>
</tr>
<tr>
<td class="address-1"><span id="36423"></span>36423</td>
<td class="instruction">SCF</td>
</tr>
<tr>
<td class="address-1"><span id="36424"></span>36424</td>
<td class="instruction">RL A</td>
</tr>
<tr>
<td class="address-1"><span id="36426"></span>36426</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="address-1"><span id="36427"></span>36427</td>
<td class="instruction">LD A,0</td>
</tr>
<tr>
<td class="address-1"><span id="36429"></span>36429</td>
<td class="instruction">ADC A,92</td>
</tr>
<tr>
<td class="address-1"><span id="36431"></span>36431</td>
<td class="instruction">LD H,A</td>
</tr>
<tr>
<td class="address-1"><span id="36432"></span>36432</td>
<td class="instruction">LD A,(32884)</td>
<td class="comment-1" rowspan="1">Pick up the attribute of the last item drawn from <a href="32884.html">32884</a></td>
</tr>
<tr>
<td class="address-1"><span id="36435"></span>36435</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Set the zero flag if all the items have been collected</td>
</tr>
<tr>
<td class="address-1"><span id="36436"></span>36436</td>
<td class="instruction">LD A,7</td>
<td class="comment-1" rowspan="1">Assume we will draw Eugene with white INK</td>
</tr>
<tr>
<td class="address-1"><span id="36438"></span>36438</td>
<td class="instruction">JR NZ,<a href="36344.html#36447">36447</a></td>
<td class="comment-1" rowspan="1">Jump if there are items remaining to be collected</td>
</tr>
<tr>
<td class="address-1"><span id="36440"></span>36440</td>
<td class="instruction">LD A,(32957)</td>
<td class="comment-1" rowspan="1">Pick up the value of the game clock at <a href="32957.html">32957</a></td>
</tr>
<tr>
<td class="address-1"><span id="36443"></span>36443</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="3">Move bits 2-4 into bits 0-2 and clear the other bits; this value (which decreases by one on each pass through the main loop) will be Eugene's INK colour</td>
</tr>
<tr>
<td class="address-1"><span id="36444"></span>36444</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="address-1"><span id="36445"></span>36445</td>
<td class="instruction">AND 7</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="36447"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a href="36469.html">36469</a> (to set the attributes for a Skylab), <a href="36593.html">36593</a> (to set the attributes for a vertical guardian) and <a href="37173.html">37173</a> (to set the attributes for the Kong Beast).
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="36447"></span>36447</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Save the INK colour in the attribute buffer temporarily</td>
</tr>
<tr>
<td class="address-1"><span id="36448"></span>36448</td>
<td class="instruction">LD A,(32800)</td>
<td class="comment-1" rowspan="1">Pick up the attribute byte of the background tile for the current cavern from <a href="32800.html">32800</a></td>
</tr>
<tr>
<td class="address-1"><span id="36451"></span>36451</td>
<td class="instruction">AND 248</td>
<td class="comment-1" rowspan="2">Combine its PAPER colour with the chosen INK colour</td>
</tr>
<tr>
<td class="address-1"><span id="36453"></span>36453</td>
<td class="instruction">OR (HL)</td>
</tr>
<tr>
<td class="address-1"><span id="36454"></span>36454</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Set the attribute byte for the top-left cell of the sprite in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="address-1"><span id="36455"></span>36455</td>
<td class="instruction">LD DE,31</td>
<td class="comment-1" rowspan="1">Prepare <span class="register">DE</span> for addition</td>
</tr>
<tr>
<td class="address-1"><span id="36458"></span>36458</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Set the attribute byte for the top-right cell of the sprite in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="address-1"><span id="36459"></span>36459</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="36460"></span>36460</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="2">Set the attribute byte for the middle-left cell of the sprite in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="address-1"><span id="36461"></span>36461</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="36462"></span>36462</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Set the attribute byte for the middle-right cell of the sprite in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="address-1"><span id="36463"></span>36463</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="36464"></span>36464</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-1" rowspan="2">Set the attribute byte for the bottom-left cell of the sprite in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="address-1"><span id="36465"></span>36465</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="36466"></span>36466</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="2">Set the attribute byte for the bottom-right cell of the sprite in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="address-1"><span id="36467"></span>36467</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="address-1"><span id="36468"></span>36468</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="36266.html">36266</a>
</td>
<td class="up">Up: <a href="../maps/all.html#36344">Map</a></td>
<td class="next">
Next: <a href="36469.html">36469</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20200731</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2020 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.2.</div>
<div><a href="../../asm/8DF8.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>