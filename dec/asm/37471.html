<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 37471</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../../images/logo-dec.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="37434.html">37434</a>
</td>
<td class="up">Up: <a href="../maps/all.html#37471">Map</a></td>
<td class="next">
Next: <a href="37503.html">37503</a>
</td>
</tr>
</table>
<div class="description">37471: Check and set the attribute byte for a cell occupied by Willy's sprite</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="37434.html">37434</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">15 or Willy's y-coordinate</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of the cell in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="37471"></span>37471</td>
<td class="instruction">LD A,(32800)</td>
<td class="comment-1" rowspan="1">Pick up the attribute byte of the background tile for the current cavern from <a href="32800.html">32800</a></td>
</tr>
<tr>
<td class="address-1"><span id="37474"></span>37474</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Does this cell contain a background tile?</td>
</tr>
<tr>
<td class="address-1"><span id="37475"></span>37475</td>
<td class="instruction">JR NZ,<a href="37471.html#37488">37488</a></td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="address-1"><span id="37477"></span>37477</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="2">Set the zero flag if we are going to retain the INK colour in this cell; this happens only if the cell is in the bottom row and Willy's sprite is confined to the top two rows</td>
</tr>
<tr>
<td class="address-1"><span id="37478"></span>37478</td>
<td class="instruction">AND 15</td>
</tr>
<tr>
<td class="address-1"><span id="37480"></span>37480</td>
<td class="instruction">JR Z,<a href="37471.html#37488">37488</a></td>
<td class="comment-1" rowspan="1">Jump if we are going to retain the current INK colour in this cell</td>
</tr>
<tr>
<td class="address-1"><span id="37482"></span>37482</td>
<td class="instruction">LD A,(32800)</td>
<td class="comment-1" rowspan="1">Pick up the attribute byte of the background tile for the current cavern from <a href="32800.html">32800</a></td>
</tr>
<tr>
<td class="address-1"><span id="37485"></span>37485</td>
<td class="instruction">OR 7</td>
<td class="comment-1" rowspan="1">Set bits 0-2, making the INK white</td>
</tr>
<tr>
<td class="address-1"><span id="37487"></span>37487</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Set the attribute byte for this cell in the buffer at <a href="23552.html">23552</a></td>
</tr>
<tr>
<td class="address-2"><span id="37488"></span>37488</td>
<td class="instruction">LD A,(32845)</td>
<td class="comment-1" rowspan="1">Pick up the attribute byte of the first nasty tile for the current cavern from <a href="32800.html#32845">32845</a></td>
</tr>
<tr>
<td class="address-1"><span id="37491"></span>37491</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Has Willy hit a nasty of the first kind?</td>
</tr>
<tr>
<td class="address-1"><span id="37492"></span>37492</td>
<td class="instruction">JP Z,<a href="36101.html">36101</a></td>
<td class="comment-1" rowspan="1">Kill Willy if so</td>
</tr>
<tr>
<td class="address-1"><span id="37495"></span>37495</td>
<td class="instruction">LD A,(32854)</td>
<td class="comment-1" rowspan="1">Pick up the attribute byte of the second nasty tile for the current cavern from <a href="32800.html#32854">32854</a></td>
</tr>
<tr>
<td class="address-1"><span id="37498"></span>37498</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Has Willy hit a nasty of the second kind?</td>
</tr>
<tr>
<td class="address-1"><span id="37499"></span>37499</td>
<td class="instruction">JP Z,<a href="36101.html">36101</a></td>
<td class="comment-1" rowspan="1">Kill Willy if so</td>
</tr>
<tr>
<td class="address-1"><span id="37502"></span>37502</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="37434.html">37434</a>
</td>
<td class="up">Up: <a href="../maps/all.html#37471">Map</a></td>
<td class="next">
Next: <a href="37503.html">37503</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20221122</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2022 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.8.</div>
<div><a href="../../asm/925F.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>