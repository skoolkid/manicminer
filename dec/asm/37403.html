<!DOCTYPE html>
<html>
<head>
<title>Manic Miner: Routine at 37403</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="Manic Miner" src="../../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="37173.html">37173</a>
</td>
<td class="up">Up: <a href="../maps/all.html#37403">Map</a></td>
<td class="next">
Next: <a href="37434.html">37434</a>
</td>
</tr>
</table>
<div class="description">37403: Flip a switch in a Kong Beast cavern if Willy is touching it</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="37173.html">37173</a>. Returns with the zero flag set if Willy flips the switch.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of the switch's location in the attribute buffer at <a href="23552.html">23552</a></td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="address-2"><span id="37403"></span>37403</td>
<td class="instruction">LD A,(32876)</td>
<td class="comment-1" rowspan="1">Pick up the LSB of the address of Willy's location in the attribute buffer at <a href="23552.html">23552</a> from <a href="32876.html">32876</a></td>
</tr>
<tr>
<td class="address-1"><span id="37406"></span>37406</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="3">Is it equal to or one less than the LSB of the address of the switch's location?</td>
</tr>
<tr>
<td class="address-1"><span id="37407"></span>37407</td>
<td class="instruction">AND 254</td>
</tr>
<tr>
<td class="address-1"><span id="37409"></span>37409</td>
<td class="instruction">CP L</td>
</tr>
<tr>
<td class="address-1"><span id="37410"></span>37410</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return (with the zero flag reset) if not</td>
</tr>
<tr>
<td class="address-1"><span id="37411"></span>37411</td>
<td class="instruction">LD A,(32877)</td>
<td class="comment-1" rowspan="1">Pick up the MSB of the address of Willy's location in the attribute buffer at <a href="23552.html">23552</a> from <a href="32876.html">32877</a></td>
</tr>
<tr>
<td class="address-1"><span id="37414"></span>37414</td>
<td class="instruction">CP H</td>
<td class="comment-1" rowspan="1">Does it match the MSB of the address of the switch's location?</td>
</tr>
<tr>
<td class="address-1"><span id="37415"></span>37415</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return (with the zero flag reset) if not</td>
</tr>
<tr>
<td class="address-1"><span id="37416"></span>37416</td>
<td class="instruction">LD A,(32869)</td>
<td class="comment-1" rowspan="1">Pick up the sixth byte of the graphic data for the switch tile from <a href="32800.html#32863">32869</a></td>
</tr>
<tr>
<td class="address-1"><span id="37419"></span>37419</td>
<td class="instruction">LD H,117</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the sixth row of pixels of the switch tile in the screen buffer at <a href="28672.html">28672</a></td>
</tr>
<tr>
<td class="address-1"><span id="37421"></span>37421</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">Has the switch already been flipped?</td>
</tr>
<tr>
<td class="address-1"><span id="37422"></span>37422</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return (with the zero flag reset) if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="37423"></span>
<div class="comments">
<div class="paragraph">
Willy is flipping the switch.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-1"><span id="37423"></span>37423</td>
<td class="instruction">LD (HL),8</td>
<td class="comment-1" rowspan="5">Update the sixth, seventh and eighth rows of pixels of the switch tile in the screen buffer at <a href="28672.html">28672</a> to make it appear flipped</td>
</tr>
<tr>
<td class="address-1"><span id="37425"></span>37425</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="37426"></span>37426</td>
<td class="instruction">LD (HL),6</td>
</tr>
<tr>
<td class="address-1"><span id="37428"></span>37428</td>
<td class="instruction">INC H</td>
</tr>
<tr>
<td class="address-1"><span id="37429"></span>37429</td>
<td class="instruction">LD (HL),6</td>
</tr>
<tr>
<td class="address-1"><span id="37431"></span>37431</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">Set the zero flag: Willy has flipped the switch</td>
</tr>
<tr>
<td class="address-1"><span id="37432"></span>37432</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">This instruction is redundant</td>
</tr>
<tr>
<td class="address-1"><span id="37433"></span>37433</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="37173.html">37173</a>
</td>
<td class="up">Up: <a href="../maps/all.html#37403">Map</a></td>
<td class="next">
Next: <a href="37434.html">37434</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete Manic Miner RAM disassembly 20191112</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd. &#169; 2019 Richard Dymond.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.0.</div>
<div><a href="../../asm/921B.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>